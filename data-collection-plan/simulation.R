
pyli_lambda
pyli_lambda <- c(
    0.786, -0.002,  0.115, -0.003,  0.010,  0.008,
    0.746,  0.024,  0.158,  0.035,  0.038, -0.001,
    0.716,  0.071,  0.189, -0.009, -0.016, -0.008,
    0.646, -0.012, -0.011, -0.133, -0.050,  0.321,
    0.606,  0.044, -0.036,  0.002,  0.023,  0.368,
    0.581,  0.113, -0.038,  0.097,  0.061, -0.105,
    0.416, -0.091,  0.028,  0.120, -0.013,  0.368,
    0.111,  0.800, -0.048, -0.037,  0.198,  0.024,
    -0.016,  0.753,  0.186,  0.063,  0.004,  0.129,
    0.036,  0.661,  0.040,  0.251, -0.012, -0.048,
    0.121, -0.056,  0.638,  0.118,  0.045,  0.065,
    0.033,  0.039,  0.633, -0.073,  0.153, -0.021,
    0.014,  0.189,  0.620,  0.042,  0.007, -0.018,
    -0.016,  0.103,  0.080,  0.695, -0.181, -0.038,
    0.086, -0.111, -0.126,  0.623,  0.133,  0.124,
    -0.169,  0.058,  0.004,  0.593,  0.104,  0.025,
    0.058,  0.120,  0.066,  0.418, -0.033, -0.107,
    -0.022, -0.042,  0.142,  0.151,  0.805, -0.025,
    0.049,  0.114, -0.012,  0.045,  0.704, -0.038,
    -0.008,  0.069,  0.208, -0.045,  0.695,  0.085,
    0.017,  0.007,  0.111,  0.031, -0.060,  0.728,
    -0.019,  0.031, -0.065, -0.003,  0.085,  0.692,
    0.002,  0.185,  0.036, -0.051,  0.044,  0.559)

pyli_lambda <- matrix(pyli_lambda,ncol = 6, byrow = T)

pyli_mean <- c(4.78,
               4.90,
               4.95,
               4.49,
               4.62,
               4.57,
               3.73,
               5.14,
               5.21,
               4.98,
               4.94,
               5.12,
               4.96,
               4.30,
               4.37,
               4.77,
               4.57,
               5.12,
               5.13,
               5.14,
               4.54,
               4.32,
               4.26)

R_imp <- pyli_lambda %*% t(pyli_lambda)
corrplot(R_imp)
diag(R_imp) <- 1
eigen(R_imp)$values

library(mvtnorm)

dat <- rmvnorm(1000,mean = pyli_mean,sigma = R_imp)

R <- cor(dat)
R
dat <- round(dat)
library(GPArotation)
summary(fa(R, 6))

pyli_lambda

slc_CR <- c(.64,0,0,0,
            .57,0,0,0,
            .57,0,0,0,
            .68,0,0,0,
            .63,0,0,0,
            .44,0,0,0,
            .75,0,0,0,
            .80,0,0,0,
            .82,0,0,0,
            0,0,.58,0,
            0,0,.92,0,
            0,0,.88,0,
            0,0,0,.56,
            0,0,0,.66,
            0,.42,0,.40,
            0,.96,0,0,
            0,.94,0,0,
            0,.85,0,0)

slc_CR <- matrix(slc_CR,ncol = 4, byrow = T)

slc_C <- c(.72,0,0,0,0,
           .78,0,0,0,0,
           .66,0,0,0,0,
           .59,0,0,0,0,
           .60,0,0,0,0,
           0,0,0,-.80,0,
           0,0,0,-.90,0,
           0,0,0,-.82,0,
           0,0,0,-.63,0,
           0,-.95,0,0,0,
           0,-.94,0,0,0,
           0,-.90,0,0,0,
           0,0,.61,0,0,
           0,0,.54,0,0,
           0,0,.77,0,0,
           0,0,.71,0,0,
           0,0,.63,0,0,
           0,0,.57,0,0,
           0,0,0,0,-.52,
           0,0,0,0,-.86,
           0,0,0,0,-.79)

slc_C <- matrix(slc_C,ncol = 5, byrow = T)

slc_GD <- c(.83,0,0,
            .85,0,0,
            .85,0,0,
            .81,0,0,
            .74,0,0,
            .65,0,0,
            0,.89,0,
            0,.91,0,
            0,.87,0,
            0,0,.92,
            0,0,.90,
            0,0,.52)

slc_GD <- matrix(slc_GD,ncol = 3, byrow = T)

slc_II <- c(0,0,0,.49,0,0,
            0,0,0,0,0,0,
            0,0,0,.59,0,0,
            0,0,0,.69,0,0,
            0,0,0,.70,0,0,
            0,0,0,.65,0,0,
            .79,0,0,0,0,0,
            .67,0,0,0,0,0,
            .77,0,0,0,0,0,
            .62,0,0,0,0,0,
            .49,0,0,0,0,0,
            .50,0,0,0,0,0,
            0,0,0,0,0,.73,
            0,0,0,0,0,.70,
            0,0,0,0,0,.55,
            0,-.77,0,0,0,0,
            0,-.76,0,0,0,0,
            0,-.67,0,0,0,0,
            0,-.68,0,0,0,0,
            0,-.77,0,0,0,0,
            0,-.70,0,0,0,0,
            0,0,.42,0,0,0,
            0,0,.87,0,0,0,
            0,0,.81,0,0,0,
            0,0,0,0,0,.79,
            0,0,0,0,0,.71,
            0,0,0,0,0,0,
            0,0,0,0,-.47,0,
            0,0,0,0,-.58,0,
            0,0,0,0,-.54,0,
            0,0,.51,0,0,0,
            0,0,0,0,-.42,0,
            0,0,.84,0,0,0)

slc_II  <- matrix(slc_II,ncol = 6, byrow = T)

slc_LR <- c(0,0,0,0,.73,0,
            0,0,0,0,.68,0,
            0,0,0,0,.65,0,
            0,0,0,.59,0,0,
            0,0,0,.56,0,0,
            0,0,0,.69,0,0,
            0,0,0,0,0,-.86,
            0,0,0,0,0,-.86,
            0,0,0,0,0,-.80,
            0,0,0,0,0,0,
            .52,0,0,0,0,0,
            .43,0,0,0,0,0,
            .61,0,0,0,0,0,
            .40,0,0,0,0,0,
            .71,0,0,0,0,0,
            .69,0,0,0,0,0,
            .72,0,0,0,0,0,
            .78,0,0,0,0,0,
            0,0,.61,0,0,0,
            0,0,.74,0,0,0,
            0,0,.64,0,0,0,
            0,-.88,0,0,0,0,
            0,-.85,0,0,0,0,
            0,-.89,0,0,0,0,
            0,-.44,0,0,0,0,
            0,-.49,0,0,0,0,
            0,-.46,0,0,0,0,
            0,0,.53,0,0,0,
            0,0,.53,0,0,0,
            0,0,.49,0,0,0)

slc_LR  <- matrix(slc_LR,ncol = 6, byrow = T)

slc_SA <- c(.63,0,0,0,0,
            .52,0,0,0,0,
            .53,0,0,0,0,
            .83,0,0,0,0,
            .80,0,0,0,0,
            .72,0,0,0,0,
            0,0,0,.77,0,
            0,0,0,.84,0,
            0,0,0,.85,0,
            0,.64,0,0,0,
            0,.82,0,0,0,
            0,.84,0,0,0,
            0,0,0,0,-.74,
            0,0,0,0,-.81,
            0,0,0,0,-.71,
            0,0,-.62,0,0,
            0,0,-.68,0,0,
            0,0,-.66,0,0)

slc_SA  <- matrix(slc_SA,ncol = 5, byrow = T)

slc_SP <- c(0,-.74,0,
            0,-.85,0,
            0,-.83,0,
            0,-.79,0,
            0,-.88,0,
            0,-.80,0,
            .83,0,0,
            .80,0,0,
            .83,0,0,
            .75,0,0,
            .70,0,0,
            .80,0,0,
            0,0,.82,
            0,0,.91,
            0,0,.90)

slc_SP  <- matrix(slc_SP,ncol = 3, byrow = T)

slc <- list(slc_C = list(lambda = slc_C),
            slc_CR = list(lambda = slc_CR),
            slc_GD = list(lambda = slc_GD),
            slc_II = list(lambda = slc_II),
            slc_LR = list(lambda = slc_LR),
            slc_SA = list(lambda = slc_SA),
            slc_SP = list(lambda = slc_SP))

slc <- lapply(slc,function(x){
    n_facets <- nrow(x$lambda)/3
    return(list(lambda = x$lambda, n_facets = n_facets))
})

R_imp <- slc_SP %*% t(slc_SP)
diag(R_imp) <- 1
evar <- diag(diag(23) - pyli_lambda %*% t(slc_SP))
out <- rmvnorm(1000,sigma = R_imp)

R_imp
cor(out) - R_imp
cor(out) - R_imp
R_imp

out

colnames(out)  <- paste0("x",1:15)
head(out)

slc_SP

mod <- '
f1 =~  NA*x1 + x2 + x3 + x4 + x5 + x6
f2 =~  NA*x7 + x8 + x9 + x10 + x11 + x12
f3 =~  NA*x13 + x14 + x15
f1 ~~ 1*f1
f2 ~~ 1*f2
f3 ~~ 1*f3
f1 ~~ f2
f1 ~~ 0*f3
f2 ~~ 0*f3'

cov(out)
summary(sem(mod,t(out2), missing ="ML"))
summary(sem(mod,out))

out2 <- t(apply(out, 1,function(x){
    tp <- sample(1:3,1)
    if(tp == 1){
        x[-1:-6] <- NA
    } else if(tp == 2){
        x[-7:-12] <- NA
    } else if(tp == 3){
        x[-13:-15] <- NA
    }
    x
}))

